{"paragraphs":[{"text":"    // initialize input RDD\r\n    val inputDF = sqlContext.read.parquet(\"hdfs://lambda-pluralsight:9000/lambda/weblogs-app1/\")\r\n      .where(\"unix_timestamp() - timestamp_hour / 1000 <= 60 * 60 * 6\")\r\n\r\n    inputDF.registerTempTable(\"activity\")\r\n    val visitorsByProduct = sqlContext.sql(\r\n      \"\"\"SELECT product, timestamp_hour, COUNT(DISTINCT visitor) as unique_visitors\r\n        |FROM activity GROUP BY product, timestamp_hour\r\n      \"\"\".stripMargin)\r\n\r\n    visitorsByProduct\r\n      .write\r\n      .format(\"org.apache.spark.sql.cassandra\")\r\n      .options(Map( \"keyspace\" -> \"lambda\", \"table\" -> \"batch_visitors_by_product\"))\r\n      .save()\r\n\r\n    val activityByProduct = sqlContext.sql(\r\n            \"\"\"SELECT\r\n                    product,\r\n                    timestamp_hour,\r\n                    sum(case when action = 'purchase' then 1 else 0 end) as purchase_count,\r\n                    sum(case when action = 'add_to_cart' then 1 else 0 end) as add_to_cart_count,\r\n                    sum(case when action = 'page_view' then 1 else 0 end) as page_view_count\r\n                    from activity\r\n                    group by product, timestamp_hour \"\"\").cache()\r\n\r\n    activityByProduct\r\n      .write\r\n      .format(\"org.apache.spark.sql.cassandra\")\r\n      .options(Map( \"keyspace\" -> \"lambda\", \"table\" -> \"batch_activity_by_product\"))\r\n      .save()","dateUpdated":"2016-10-08T23:56:14-0400","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1475953644183_824859126","id":"20161008-150724_1360954826","dateCreated":"2016-10-08T03:07:24-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:874","dateFinished":"2016-10-08T23:56:51-0400","dateStarted":"2016-10-08T23:56:14-0400","errorMessage":"","focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"product","index":0,"aggr":"sum"}],"values":[{"name":"page_view_count","index":3,"aggr":"sum"}],"groups":[{"name":"product","index":0,"aggr":"sum"}],"scatter":{"xAxis":{"name":"product","index":0,"aggr":"sum"},"yAxis":{"name":"timestamp_hour","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1475985266953_1082209873","id":"20161008-235426_1874659507","dateCreated":"2016-10-08T23:54:26-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1015","dateUpdated":"2016-10-09T00:00:00-0400","dateFinished":"2016-10-09T00:00:00-0400","dateStarted":"2016-10-09T00:00:00-0400","errorMessage":"","text":"%cassandra\nselect product, page_view_count from lambda.batch_activity_by_product;"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1475985417978_-597590145","id":"20161008-235657_1456548746","dateCreated":"2016-10-08T23:56:57-0400","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1119","dateUpdated":"2016-10-08T23:57:08-0400","errorMessage":"","text":""}],"name":"Batch to Cassandra","id":"2C165F26K","angularObjects":{"2BWNYNN11:shared_process":[],"2BUSDYYKT:shared_process":[],"2BWSGTUPW:shared_process":[],"2BWU6HYPM:shared_process":[],"2BVAPTGUG:shared_process":[],"2BWUBB1VP:shared_process":[],"2BW6CXMBY:shared_process":[],"2BV4PX6B9:shared_process":[],"2BV6AB1D1:shared_process":[],"2BWXF5UXU:shared_process":[],"2BWGQ459A:shared_process":[],"2BWVEP8DM:shared_process":[],"2BVZP3C2E:shared_process":[],"2BW119W4H:shared_process":[],"2BU4UEHEY:shared_process":[],"2BUTE2D9V:shared_process":[],"2BU9D6U2X:shared_process":[],"2BUFBQENP:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}