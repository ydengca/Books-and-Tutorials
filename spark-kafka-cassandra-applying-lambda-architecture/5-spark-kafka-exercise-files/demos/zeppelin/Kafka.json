{"paragraphs":[{"text":"import _root_.kafka.serializer.StringDecoder\nimport org.apache.spark.streaming.kafka.KafkaUtils\nimport org.apache.spark.streaming._\nimport org.apache.spark.storage.StorageLevel\n\nval batchSeconds = 4\n\n@transient val ssc = new StreamingContext(sc, Seconds(batchSeconds))\nssc.checkpoint(\"hdfs://lambda-pluralsight:9000/spark/checkpoint\")\n\n\n    val kafkaParams = Map(\n      \"zookeeper.connect\" -> \"localhost:2181\",\n      \"group.id\" -> \"lambda\",\n      \"auto.offset.reset\" -> \"largest\"\n    )\n\n  case class Activity(timestamp_hour: Long,\n                      referrer: String,\n                      action: String,\n                      prevPage: String,\n                      page: String,\n                      visitor: String,\n                      product: String,\n                      inputProps: Map[String, String] = Map()\n                     )\n","dateUpdated":"2016-09-11T02:49:57-0400","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1472934306654_-1009545501","id":"20160903-162506_288666380","dateCreated":"2016-09-03T04:25:06-0400","dateStarted":"2016-09-11T02:49:57-0400","dateFinished":"2016-09-11T02:50:25-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:276","errorMessage":""},{"text":"val kstream = KafkaUtils.createStream[String, String, StringDecoder, StringDecoder](\n    ssc, kafkaParams, Map(\"weblogs-text\" -> 1), StorageLevel.MEMORY_AND_DISK)\n    .map(_._2)\n\nval activityStream = kstream.transform{ input =>\n        val inputRDD = input.flatMap { line =>\n          val record = line.split(\"\\\\t\")\n          val MS_IN_HOUR = 1000 * 60 * 60\n          if (record.length == 7) // make sure we have complete records\n            Some(Activity(record(0).toLong / MS_IN_HOUR * MS_IN_HOUR, record(1), record(2), record(3), record(4), record(5), record(6)))\n          else\n            None\n        }\n\n        val df = inputRDD.toDF()\n        df.registerTempTable(\"activity\")\n        sqlContext.cacheTable(\"activity\")\n        inputRDD\n    }\n\nactivityStream.print()\n    \nssc.remember(Minutes(5))\nssc.start()","dateUpdated":"2016-09-11T03:03:01-0400","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1472934471978_-1814811270","id":"20160903-162751_1449941681","dateCreated":"2016-09-03T04:27:51-0400","dateStarted":"2016-09-11T03:03:01-0400","dateFinished":"2016-09-11T03:03:03-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:277","errorMessage":""},{"text":"%sql\nselect * from activity","dateUpdated":"2016-09-11T03:03:14-0400","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"timestamp_hour","index":0,"aggr":"sum"}],"values":[{"name":"action","index":2,"aggr":"count"}],"groups":[{"name":"action","index":2,"aggr":"sum"}],"scatter":{"xAxis":{"name":"timestamp_hour","index":0,"aggr":"sum"},"yAxis":{"name":"referrer","index":1,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1472934710499_1382207427","id":"20160903-163150_1825662933","dateCreated":"2016-09-03T04:31:50-0400","dateStarted":"2016-09-11T03:03:14-0400","dateFinished":"2016-09-11T03:03:16-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:278","errorMessage":""},{"text":"StreamingContext.getActive.foreach { _.stop(stopSparkContext=false, stopGracefully=false) }","dateUpdated":"2016-09-10T09:00:14-0400","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1472965466708_1976938108","id":"20160904-010426_622274866","dateCreated":"2016-09-04T01:04:26-0400","dateStarted":"2016-09-10T09:00:14-0400","dateFinished":"2016-09-10T09:00:15-0400","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:279"},{"text":"","dateUpdated":"2016-09-04T01:47:26-0400","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1472968036253_-556772438","id":"20160904-014716_818985555","dateCreated":"2016-09-04T01:47:16-0400","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:280"}],"name":"Kafka","id":"2BWK41N7C","angularObjects":{"2BWNYNN11:shared_process":[],"2BUSDYYKT:shared_process":[],"2BWSGTUPW:shared_process":[],"2BWU6HYPM:shared_process":[],"2BVAPTGUG:shared_process":[],"2BWUBB1VP:shared_process":[],"2BW6CXMBY:shared_process":[],"2BV4PX6B9:shared_process":[],"2BV6AB1D1:shared_process":[],"2BWXF5UXU:shared_process":[],"2BWGQ459A:shared_process":[],"2BWVEP8DM:shared_process":[],"2BVZP3C2E:shared_process":[],"2BW119W4H:shared_process":[],"2BU4UEHEY:shared_process":[],"2BUTE2D9V:shared_process":[],"2BU9D6U2X:shared_process":[],"2BUFBQENP:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}